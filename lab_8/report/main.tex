% chktex-file 8 36 26 38 32
\documentclass[a4paper,12pt]{article}

% Packages
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{float}
\geometry{margin=1in}
\usepackage{titlesec}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage{minted}
\usepackage{colortbl}
\usepackage{setspace}
\usepackage[utf8]{inputenc}
\usepackage{newunicodechar}
\usepackage{amssymb}
\usepackage{lmodern} 
\usepackage{subcaption}
\usepackage{silence}
\WarningFilter{fancyhdr}{\headheight is too small}

\newunicodechar{âœ“}{\checkmark}  
\usepackage[most]{tcolorbox}
\tcbuselibrary{minted, listingsutf8}
\setminted{breaklines}

\newtcblisting{code}[2][]{%
  listing engine=minted,
  colback=white,
  colframe=black,
  listing only,
  minted language=#2,
  minted options={fontsize=\small, linenos, breaklines,
                  breaksymbolleft=, breaksymbolright=, #1},
  sharp corners,
  boxrule=0.8pt,
  left=5pt,
  right=5pt,
  top=8pt,
  bottom=8pt,
  enhanced,
  breakable
}


\lstset{
  basicstyle=\ttfamily\small,
  keywordstyle=\color{blue},
  stringstyle=\color{red},
  commentstyle=\color{green!50!black},
  breaklines=true,
  frame=single,
  numbers=left,
  numberstyle=\tiny,
  stepnumber=1,
  numbersep=5pt,
  showstringspaces=false,
  tabsize=2,
}

% Header and footer setup for all pages except cover
\fancypagestyle{main}{
  \fancyhf{}
  \rhead{CSC381 - E-Commerce}
  \lhead{Lab 8: User Authentication and Session Management}
  \cfoot{\thepage}
  \renewcommand{\headrulewidth}{0.4pt}
  \renewcommand{\footrulewidth}{0.4pt}
}

\title{Lab 8: User Authentication and Session Management}
\author{Submitted by: Parakram Kharel \\ Roll No: 24 \\ 
\textit{Kathford International College of Engineering and Management} \\ 
Affiliated to Tribhuvan University}
% \date{\today}
\makeatletter
\begin{document}
% \date{August 17, 2025}

% --------- Cover Page ---------
\begin{titlepage}
  \begin{center}
    \vspace*{2cm}
    \includegraphics[width=0.35\textwidth]{Kath.png} \\[2cm]

    {\Huge \bfseries Lab Report 8} \\[0.5cm]
    {\Large User Authentication and Session Management} \\[2cm]

    {\Large \textbf{Course:} CSC381 - E-Commerce} \\[1cm]
    {\Large \textbf{Submitted by:}} \\[0.3cm]
    {\large Parakram Kharel \\ Roll No: 24} \\[2cm]

    \textit{Kathford International College of Engineering and Management} \\
    Affiliated to Tribhuvan University \\[3cm]
    
    \date{August 31, 2025}
    {\normalsize \@date}
    % \today
  \end{center}
\end{titlepage}

% Use fancy header/footer for the rest of the document
\pagestyle{main}
\setlength{\parskip}{1em}

% --------- Content ---------
\section*{1. Objective}
To develop a secure login and registration system that allows customers to register, log in, and maintain sessions during their visit to the e-commerce website.

\section*{2. Tools and Technologies Used}
\begin{longtable}{ll}
\toprule
\textbf{Technology} & \textbf{Purpose} \\
\midrule
HTML5 & Admin pages and form structure \\
CSS3 & Layout and visual styling \\
ReactJS & Inline confirmations and UI behavior \\
PHP(Laravel) & Server-side logic, CRUD \\
MySQL & Persistent storage for catalog and orders \\
Caddy & Web server and local hosting \\
Bootstrap 5 & Admin UI, tables, forms, responsive grid \\
VS Code & Development environment \\
Browser DevTools & Testing and debugging \\
\bottomrule
\end{longtable}

\section*{3. Theory / Background}
User authentication ensures that only registered users can access protected pages (like the shopping cart or checkout).
PHP sessions are used to remember the logged-in user while they browse.
The main components include:
\begin{itemize}
    \item Registration: Collects user details and stores them in a MySQL database (with password hashing).
    \item Login: Validates entered credentials and starts a session.
    \item Session Management: Keeps users logged in until they log out.
  
\end{itemize}

\section*{4. Page Layout Design}
\subsection*{4.1 Registration Page}
\begin{itemize}
  \item Header - Title "Customer Registration"
  \item Input Fields (Name, Email, Password,Contact No, Date of Birth)
  \item Email Confirmation
  \item Submit Button: "Register"
  \item Link: Already have an account? -> Login Page
\end{itemize}

\subsection*{4.2 Login Page}
\begin{itemize}
  \item Header - Title "Customer Login"
  \item Input Fields (Email, Password)
  \item Submit Button: "Login"
  \item Link: Don't have an account? -> Registration Page
\end{itemize}

\subsection*{4.3 Dashboard}
\begin{itemize}
  \item Header - Title "Dashboard"
  \item Navigation Bar
  \item Content Area
\end{itemize}

  
\section*{5. Code Snippets}

\subsection*{5.1 Login Controller}
\begin{code}[fontsize=\small]{php}
<?php
  // Handle Login
  public function store(LoginRequest $request): RedirectResponse
  {
    $request->authenticate();
    $request->session()->regenerate();
    $user = Auth::user()->loadMissing('roles');
    $userRole = $user->roles->role ?? null;
    if (in_array($userRole, ['admin', 'superadmin'])) {
      return redirect()->intended(route('admin.dashboard', absolute: false));
    }
    return redirect()->intended(route('dashboard', absolute: false));
  }
  // Display Login Page
  public function create(Request $request): Response
  {
    return Inertia::render('auth/login', [
      'canResetPassword' => Route::has('password.request'),
      'status' => $request->session()->get('status'),
    ]);
  }

?>
\end{code}

\subsection*{5.2 Register Controller}
\begin{code}[fontsize=\small]{php}
<?php
// Handle Register
class Customer extends Model{
    protected $table = 'customers';
    protected $primaryKey = 'id';
    protected $fillable = [
        'name',
        'contact',
        'email',
        'address',
        'dob',
        'user_id',
        'avatar_id',
    ];

    public function user(): BelongsTo    {
        return $this->belongsTo(User::class);
    }

    public function avatar(): BelongsTo    {
        return $this->belongsTo(Avatar::class);
    }
}

public function create(): Response    {
    return Inertia::render('auth/register');
}

public function store(Request $request): RedirectResponse  {
  $request->validate([
      'name' => 'required|string|max:255',
      'contact' => 'required|string|max:255',
      'email' => 'required|string|lowercase|email|max:255|unique:'.User::class,
      'address' => 'required|string|max:255',
      'dob' => 'required|date',
  ]);
  $customerRole = \App\Models\Roles::where('role', 'customer')->first();
  $user = User::create([
      'name' => $request->name,
      'email' => $request->email,
      'password' => Hash::make(Str::random(16)), // random fake pass
      'role_id' => $customerRole ? $customerRole->id : null,
  ]);
  $customer = Customer::create([
      'name' => $request->name,
      'contact' => $request->contact,
      'email' => $request->email,
      'address' => $request->address,
      'dob' => $request->dob,
      'user_id' => $user->id,
  ]);

  event(new Registered($user));
  Password::sendResetLink(['email' => $user->email]);
  return redirect()->route('login')->with('status', 
    'Registration successful! Please check your email to set your password.');
}
?>
\end{code}

\subsection*{5.3 Login Page}
\begin{code}[fontsize=\small]{html}
<form className="space-y-6" onSubmit={submit}>
  <div className="space-y-2">
      <Label htmlFor="email">
          Email address
      </Label>
      <div className="relative">
          <Mail className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" />
          <Input id="email" type="email" required autoFocus tabIndex={1} 
          autoComplete="email" value={data.email}
          onChange={(e) => setData('email', e.target.value)}
          placeholder="email@example.com"
          />
      </div>
      <InputError message={errors.email} />
  </div>

  <div className="space-y-2">
      <div className="flex items-center justify-between">
          <Label htmlFor="password">
              Password
          </Label>
          {canResetPassword && (
              <TextLink href={route('password.request')} tabIndex={5}>
                  Forgot password?
              </TextLink>
          )}
      </div>
      <div className="relative">
          <Lock />
          <Input id="password" type={showPassword ? "text" : "password"}
              required tabIndex={2} autoComplete="current-password"
              value={data.password}
              onChange={(e) => setData('password', e.target.value)}
              placeholder="Enter your password"
          />
          <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
          >
              {showPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
          </button>
      </div>
      <InputError message={errors.password} />
  </div>

  <div className="flex items-center space-x-3">
      <Checkbox id="remember" name="remember" checked={data.remember}
          onClick={() => setData('remember', !data.remember)}
          tabIndex={3}
      />
      <Label htmlFor="remember">
          Remember me
      </Label>
  </div>

  <Button type="submit" tabIndex={4} disabled={processing}>
      {processing && <LoaderCircle />}
      {processing ? 'Signing in...' : 'Sign in'}
  </Button>
</form>
\end{code}

\subsection*{5.4 Register Page}
\begin{code}[fontsize=\small]{html}
<form onSubmit={submit}>
  <Label htmlFor="name">Full Name</Label>
  <Input id="name" type="text" required value={data.name} onChange={e => setData('name', e.target.value)} disabled={processing} placeholder="John Doe" />
  <InputError message={errors.name} />

  <Label htmlFor="contact">Contact Number</Label>
  <Input id="contact" type="text" required value={data.contact} onChange={e => setData('contact', e.target.value)} disabled={processing} placeholder="+1234567890" />
  <InputError message={errors.contact} />

  <Label htmlFor="email">Email Address</Label>
  <Input id="email" type="email" required value={data.email} onChange={e => setData('email', e.target.value)} disabled={processing} placeholder="email@example.com" />
  <InputError message={errors.email} />

  <Label htmlFor="address">Address</Label>
  <Input id="address" type="text" required value={data.address} onChange={e => setData('address', e.target.value)} disabled={processing} placeholder="123 Street Name, City" />
  <InputError message={errors.address} />

  <Label htmlFor="dob">Date of Birth</Label>
  <DatePicker
    id="dob"
    selected={data.dob ? new Date(data.dob) : null}
    onChange={d => setData('dob', d ? d.toISOString().split('T')[0] : '')}
    maxDate={new Date()}
    dateFormat="yyyy-MM-dd"
    placeholderText="YYYY-MM-DD"
    required
  />
  <InputError message={errors.dob} />

  <Button type="submit">
    Register
  </Button>

  <div>
    Already have an account? <TextLink href={route('login')}>Log in</TextLink>
  </div>
</form>
\end{code}

\section*{6. Output / Screenshots}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth, height=6cm, keepaspectratio]{images/register_page.png}
  \caption{Register Page.}
  \label{fig:img1}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth,height=6cm, keepaspectratio]{images/register_success.png}
  \caption{Register Success.}
  \label{fig:img2}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth,height=6cm, keepaspectratio]{images/login_page.png}
  \caption{Login Page.}
  \label{fig:img3}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth,height=6cm, keepaspectratio]{images/reset_password.png}
  \caption{Reset Password Page.}
  \label{fig:img4}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth,height=5cm, keepaspectratio]{images/email_reset.png}
  \caption{Password Reset Email.}
  \label{fig:img5}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth,height=6cm, keepaspectratio]{images/dashboard.png}
  \caption{Dashboard after login.}
  \label{fig:img6}
\end{figure}



\section*{7. Result}
In this lab, a complete user authentication system was successfully implemented using PHP and MySQL.

\section*{8. Conclusion}
The lab demonstrated the core concept of authentication and session management, which are essential in secure web applications.

\section*{9. References}
\begin{itemize}
  \item \href{https://www.php.net/manual/en/mysqli.prepare.php}{PHP mysqli Prepared Statements}
  \item \href{https://laravel.com/docs/11.x/authentication}{Laravel Authentication}
  \item \href{https://getbootstrap.com/docs/5.3/getting-started/introduction/}{Bootstrap 5 Documentation}
  \item \href{https://developer.mozilla.org/en-US/docs/Web/HTTP}{MDN HTTP Reference}
  \item \href{https://caddyserver.com/docs/}{Caddy Web Server Documentation}
\end{itemize}

\end{document}
